upstream goserver {
        # server 127.0.0.1:8080;
        server app:8080;
}

server {

    # gzip config
    gzip on;
    gzip_min_length 1k;
    gzip_comp_level 9;
    gzip_types text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml;
    gzip_vary on;
    gzip_disable "MSIE [1-6]\.";

    charset utf-8;
    client_max_body_size 128M;

    listen 80;
    listen 443 ssl http2 ;
    server_name demo.168zhifu.net;
    index index.php index.html ;
    root /www/wwwroot/demo.168zhifu.net;
    #CERT-APPLY-CHECK--START
    # 用于SSL证书申请时的文件验证相关配置 -- 请勿删除
    include /www/server/panel/vhost/nginx/well-known/demo.168zhifu.net.conf;
    #CERT-APPLY-CHECK--END

    #SSL-START SSL相关配置，请勿删除或修改下一行带注释的404规则
    #error_page 404/404.html;
    ssl_certificate    /www/server/panel/vhost/cert/demo.168zhifu.net/fullchain.pem;
    ssl_certificate_key    /www/server/panel/vhost/cert/demo.168zhifu.net/privkey.pem;
    ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;
    ssl_ciphers EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    add_header Strict-Transport-Security "max-age=31536000";


	location ~^/(pub|api|callback|dev)/ { 
	proxy_pass http://goserver;#代理到上面的地址去 
	proxy_http_version 1.1; 
	proxy_set_header Upgrade $http_upgrade; 
	proxy_set_header Connection “Upgrade”; 
	proxy_set_header X-Real-IP $remote_addr;
	proxy_set_header X-Forwarded-For $remote_addr;

	}
	
    location / {
    	try_files $uri $uri/ /index.php?$args;
    }
    
       location /logic/ {
    	try_files $uri $uri/ /logic/index.html?$args;
    }

    # uncomment to avoid processing of calls to non-existing static files by Yii
    #location ~ \.(js|css|png|jpg|gif|swf|ico|pdf|mov|fla|zip|rar)$ {
    #    try_files $uri =404;
    #}
    #error_page 404 /404.html;

    location ~ \.php$ {
        include fastcgi_params;
        fastcgi_param SCRIPT_FILENAME $document_root/$fastcgi_script_name;
        fastcgi_pass   127.0.0.1:9000;
        #fastcgi_pass unix:/var/run/php5-fpm.sock;
        try_files $uri =404;
    }

    location ~ /\.(ht|svn|git) {
        deny all;
    }
    access_log  /www/wwwlogs/demo.168zhifu.net.log;
    error_log  /www/wwwlogs/demo.168zhifu.net.error.log;
}
